{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {
		"subscription": {
            "type": "securestring",
            "metadata": {
                "description": "key vault's azure subscription"
            }
		},
		"resourcegroup": {
            "type": "securestring",
            "metadata": {
                "description": "key vault's azure resourcegroup"
            }
		},
		"appname": {
            "type": "String",
            "metadata": {
                "description": "Logic App Name"
            }
		},
		"location": {
            "type": "String",
            "metadata": {
                "description": "Location of Logic App"
            }
		},
		"password": {
			"type": "securestring",
			"metadata": {
				"description": "ServiceNow Credentials"
			}
		},
		"username": {
			"type": "securestring",
			"metadata": {
				"description": "ServiceNow User"
			}
		},
		"cmdb_ci": {
			"type": "String",
			"metadata": {
				"description": "CMDB CI"
			}
		},
		"assignment_group": {
			"type": "String",
			"metadata": {
				"description": "ServiceNow Assignment Group"
			}
		},
		"requestedfor": {
			"type": "String",
			"metadata": {
				"description": "Requested for"
			}
		},
		"category": {
			"type": "String",
			"metadata": {
				"description": "ServiceNow Category"
			}
		},
		"contacttype": {
			"type": "String",
			"metadata": {
				"description": "ServiceNow Contact Type"
			}
		},
		"impact": {
			"type": "String",
			"metadata": {
				"description": "Incident impact"
			}
		},
		"urgency": {
			"type": "String",
			"metadata": {
				"description": "Incident urgency"
			}
		}			
   },
   "variables": {},
   "functions": [],
   "resources": [
      {
         // Start logic app resource definition
         "properties": {
            "state": "Enabled",
            // "integrationAccount": {},
            "definition": {
				"$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
				"actions": {
					"HTTP": {
						"inputs": {
							"authentication": {
								"password": "[parameters('password')]",
								"type": "Basic",
								"username": "[parameters('username')]"
							},
							"body": {
								"assignment_group": "[parameters('assignment_group')]",
								"caller_id": "[parameters('requestedfor')]",
								"category": "[parameters('category')]",
								"cmdb_ci": "[parameters('cmdb_ci')]",
								"contact_type": "[parameters('contacttype')]",
								"description": "@concat('Azure alert created as Incident for A20 platform. Alert Details: ', join(triggerOutputs()['body']['data']['alertContext']['condition']['allOf'], ','))",
								"impact": "[parameters('impact')]",
								"short_description": "@concat('azure resource: ', join(triggerOutputs()['body']['data']['essentials']['configurationItems'], ','),' - Azure alert created as Incident for A20 platform')",
								"u_requested_for": "[parameters('requestedfor')]",
								"urgency": "[parameters('urgency')]"
							},
							"headers": {
								"Content-Type": "application/json"
							},
							"method": "POST",
							"uri": "https://kparch.service-now.com/api/now/table/incident"
						},
						"runAfter": {},
						"type": "Http"
					}
				},
				"contentVersion": "1.0.0.0",
				"outputs": {},
				"parameters": {			
				},
				"triggers": {
					"manual": {
						"inputs": {
							"schema": {}
						},
						"kind": "Http",
						"type": "Request"
					}
				}			
			},
            "parameters": {},
            "accessControl": {},
            "runtimeConfiguration": {}
         },
         "name": "[parameters('appname')]", 
         "type": "Microsoft.Logic/workflows",
         "location": "[parameters('location')]", 
         "tags": {
           "displayName": "LogicApp - Test"
         },
		 "apiVersion": "2016-06-01",
         "dependsOn": [
         ]
      }
      // End logic app resource definition
   ],
   "outputs": {}
}